const $id=e=>document.getElementById(e),navTabs=document.querySelector(".nav-tabs"),navTabButton=document.querySelectorAll(".nav-tab"),mainContents=document.querySelectorAll(".main-content"),tabsSwitcher=(e,t,a)=>{const{id:n}=e.target.dataset;if(n){t.forEach(e=>{e.classList.remove("active")}),e.target.classList.add("active"),a.forEach(e=>{e.classList.remove("active")}),document.getElementById(n).classList.add("active")}};navTabs.addEventListener("click",e=>tabsSwitcher(e,navTabButton,mainContents));const fillDiagramms=e=>{for(let t=20;t>=0;t--){const a=document.createElement("DIV"),n=document.createElement("DIV");a.append(n),a.setAttribute("class","d-flex justify-content-end "),n.setAttribute("data-value",10*t),20===t&&a.insertAdjacentHTML("afterbegin",'<div class="phase-scale ">200</div>'),10===t&&a.insertAdjacentHTML("afterbegin",'<div class="phase-scale">100</div>'),7===t&&a.insertAdjacentHTML("afterbegin",'<div class="phase-scale">80</div>'),0===t&&a.insertAdjacentHTML("afterbegin",'<div class="phase-scale">0</div>'),t>10&&n.setAttribute("class"," phase phase-high "),t<=10&&t>=8&&n.setAttribute("class"," phase phase-mid"),t<8&&n.setAttribute("class"," phase phase-low"),n.innerHTML="&nbsp;",e.append(a)}},phaseDiagramms=[...document.querySelectorAll(".phase-diagramm")];phaseDiagramms.forEach(fillDiagramms);const markElemInDiagramm=(e,t)=>{[...document.querySelectorAll(".phase")].filter(t=>t.closest(e)).filter(e=>+e.dataset.value<=t&&+e.dataset.value+10>t)[0].classList.add("phase-active","blink")},oscilloViewbtn=document.getElementById("oscilloViewbtn");oscilloViewbtn.addEventListener("click",()=>{navTabButton.forEach(e=>{e.classList.remove("active")}),document.getElementById("oscillograms-tab").classList.add("active"),mainContents.forEach(e=>{e.classList.remove("active")}),document.getElementById("oscillograms").classList.add("active")});const measurmentsTabs=document.querySelector(".measurments-tabs"),measurmentTab=document.querySelectorAll(".measurment-tab"),measurmentsContent=document.querySelectorAll(".measurments-content"),measurementsAllTab=document.querySelector("#measurements-all"),measurementsSwitchTab=document.querySelector("#measurements-switch");measurmentsTabs.addEventListener("click",e=>tabsSwitcher(e,measurmentTab,measurmentsContent));const measurementsAllTableBody=$id("measurementsAllTableBody"),measurementsSwitchTableBody=$id("measurementsSwitchTableBody"),refreshMeasurmentsTableData=$id("refreshMeasurmentsTableData");[...document.querySelectorAll(".measurments-table")].forEach(e=>{e.insertAdjacentHTML("afterBegin","\n    <thead>\n      <th>№</th>\n      <th>Дата и время</th>\n      <th>Выключатель</th>\n      <th>№ сол. откл.</th>\n      <th>Износ ф.А, %</th>\n      <th>Износ ф.В, %</th>\n      <th>Износ ф.С, %</th>\n      <th>Кол-во вкл.</th>\n      <th>Кол-во откл.</th>\n      <th>Собств. вр., мс</th>\n      <th>Полное. вр., мс</th>\n      <th>Вр. дуги ф.А, мс</th>\n      <th>Вр. дуги ф.В, мс</th>\n      <th>Вр. дуги ф.С, мс</th>\n      <th>Износ за перекл. ф.А, %</th>\n      <th>Износ за перекл. ф.В, %</th>\n      <th>Износ за перекл. ф.С, %</th>\n      <th>Ток ф.А, А</th>\n      <th>Ток ф.В, А</th>\n      <th>Ток ф.С, А</th>\n    </thead>\n    ")});let measurmentsTableCurrentObj={"0201":null,"0204":null,"0205":null,"0206":null,"0207":null,"0208":null,"0209":null,"0210":null,"0211":null,"0212":null,"0213":null,"0214":null,"0215":null,"0216":null,"0217":null,"0218":null,"0219":null,"0220":null,"0221":null,"0222":null,"0223":null,"0224":null,"0225":null,"0226":null,"0227":null,"0228":null};const addRowToMeasurmentsTable=(e,t)=>{e.insertAdjacentHTML("afterbegin",`\n  <tr>\n    <td>${t["0201"]}</td> \n    <td>\n      ${t["0206"]}.${t["0205"]}.${t["0204"]}\n      ${t["0207"]}:${t["0208"]}:${t["0209"]}.${t["0210"]}\n    </td>\n    <td>${t["0211"]}</td>\n    <td>${t["0212"]}</td>\n    <td>${.01*t["0213"]}</td>\n    <td>${.01*t["0214"]}</td>\n    <td>${.01*t["0215"]}</td>\n    <td>${t["0216"]}</td>\n    <td>${t["0217"]}</td>\n    <td>${t["0218"]}</td>\n    <td>${t["0219"]}</td>\n    <td>${t["0220"]}</td>\n    <td>${t["0221"]}</td>\n    <td>${t["0222"]}</td>\n    <td>${.01*t["0223"]}</td>\n    <td>${.01*t["0224"]}</td>\n    <td>${.01*t["0225"]}</td>\n    <td>${t["0226"]}</td>\n    <td>${t["0227"]}</td>\n    <td>${t["0228"]}</td>\n  </tr>\n`)};addRowToMeasurmentsTable(measurementsAllTableBody,measurmentsTableCurrentObj),addRowToMeasurmentsTable(measurementsSwitchTableBody,measurmentsTableCurrentObj);let eventsTableCurrentObj={"0301":null,"0303":null,"0304":null,"0305":null,"0306":null,"0307":null,"0308":null,"0309":null,"0310":null,"0311":null};const evtCode={1:"Рестарт программы",2:"Ошибка считывания конфигурации. Принята конфигурация по умолчанию",3:"Изменена конфигурация",4:"Неисправность внутренней FLASH-памяти",5:"Неисправность внутренней SRAM-памяти",6:"Неисправность АЦП",7:"Неисправность Ethernet",8:"Неисправность датчика температуры внутри модуля",9:"Неисправность датчика температуры ШУ ВВ",10:"Неисправность датчика температуры окружающей среды",11:"Ошибка считывания FRAM (энергонезависимых данных). Приняты данные по умолчанию",12:"Пользователем задано значение расхода коммутационного ресурса ф. А",13:"Пользователем задано значение расхода коммутационного ресурса ф. B",14:"Пользователем задано значение расхода коммутационного ресурса ф. C",15:"Пользователем задано значение количества включений",16:"Пользователем задано значение количества отключений",30:"Количество операций более порогового предупредительного значения",31:"Температура в шкафу управления больше порогового предупредительного значения",32:"Температура в шкафу управления меньше порогового предупредительного значения",33:"Температура внутри блока больше порогового предупредительного значения",34:"Температура внутри блока меньше порогового предупредительного значения",35:"Собственное время отключения более порогового предупредительного значения",36:"Полное время отключения более порогового предупредительного значения",37:"Собственное время включения более порогового предупредительного значения",38:"Время включения более порогового предупредительного значения",39:"Невыполненная команда на соленоид включения",40:"Невыполненная команда на соленоид отключения 1",41:"Невыполненная команда на соленоид отключения 2",50:"Количество операций более порогового аварийного значения",51:"Температура в шкафу управления больше порогового аварийного значения",52:"Температура в шкафу управления меньше порогового аварийного значения",53:"Отказ соленоида",54:"Неполнофазный режим работы",100:"Повторное зажигание дуги для фазы А",101:"Износ контактов более порогового предупредительного значения для фазы А",102:"Время горения дуги более порогового предупредительного значения для фазы А",151:"Износ контактов более порогового аварийного значения для фазы А",200:"Повторное зажигание дуги для фазы В",201:"Износ контактов более порогового предупредительного значения для фазы В",202:"Время горения дуги более порогового предупредительного значения для фазы В",251:"Износ контактов более порогового аварийного значения для фазы В",300:"Повторное зажигание дуги для фазы С",301:"Износ контактов более порогового предупредительного значения для фазы С",302:"Время горения дуги более порогового предупредительного значения для фазы С",351:"Износ контактов более порогового аварийного значения для фазы С",1000:"Ошибка установления связи с устройством",1050:"Связь с устройством установлена",17:"Пользователем сброшены аварии и тревоги",18:"Пользователем установлена сигнализация",19:"Пользователем сброшена сигнализация"},addCurrentEntryToEventsTable=()=>{const e=document.querySelector("#eventsTableBody"),t=eventsTableCurrentObj;e.insertAdjacentHTML("beforeend",`\n  <tr>\n    <td>${t["0301"]}</td>\n    <td>\n      ${t["0305"]}.${t["0304"]}.${t["0303"]}\n      ${t["0306"]}:${t["0307"]}:${t["0308"]}.${t["0309"]}\n      </td>\n    </td>\n    <td>${null===t["0310"]?t["0310"]+" (пришло)":t["0310"]+" (ушло)"}</td>\n    <td>${t["0311"]}</td>\n    <td>${evtCode[t["0311"]]}</td>\n  </tr>`)},oscillogramsTabs=document.querySelector(".oscillograms-tabs"),oscillogramTab=document.querySelectorAll(".oscillograms-tab"),oscillogramsContent=document.querySelectorAll(".oscillograms-content");oscillogramsTabs.addEventListener("click",e=>tabsSwitcher(e,oscillogramTab,oscillogramsContent));const addOptToOscilloSelect=e=>{let t=document.createElement("option");const a=t=>Object.values(e.info[t]);let n=`${1==+a(0)?"ВКЛ":"ОТКЛ"} ${a(4)}.${a(3)}.${a(2)} ${a(5)}:${a(6)}:${a(7)}.${a(8)}.${a(9)}`;t.value=a(1),t.innerHTML=n;let s=t.cloneNode(!0);$id("jsOsSelect1").appendChild(t),$id("jsOsSelect2").appendChild(s)};class Chart{constructor(e,t){this.cnv=$id(e.canvasId),this.ctx=this.cnv.getContext("2d"),this.rangeY=this.calcSourceMinMax("Y",t.a.values,t.b.values,t.c.values),this.rangeX=this.calcSourceMinMax("X",t.a.values,t.b.values,t.c.values),this.width=this.cnv.width,this.height=this.cnv.height,this.padding={x:60,y:60},this.dotRadius=2,this.left=this.padding.x,this.right=this.width-this.padding.x,this.top=this.padding.y,this.bottom=this.height-this.padding.y,this.dotsCheck=$id(e.dotsCheck),this.dotsValCheck=$id(e.dotsValCheck)}mapRange(e,t,a,n,s){return n+(s-n)*(e-t)/(a-t)}calcSourceMinMax(e,...t){let a=1/0,n=-1/0;return t.forEach(t=>{for(let s=0;s<t.length;s++){const i=t[s][e];i<a&&(a=i),i>n&&(n=i)}}),{min:a,max:n}}getDisplayXY(e,t){return{displayX:this.mapRange(e,this.rangeX.min,this.rangeX.max,this.left,this.right),displayY:this.mapRange(t,this.rangeY.min,this.rangeY.max,this.bottom,this.top)}}roundToMultiple(e,t){return Math.round(e/t)*t}connector(e,t,a){const{ctx:n}=this;n.beginPath(),n.lineWidth=2,n.moveTo(e.displayX,e.displayY),n.lineTo(t.displayX,t.displayY),n.strokeStyle=a,n.stroke()}dot(e){const{ctx:t}=this;t.beginPath(),t.moveTo(e.displayX,e.displayY),t.arc(e.displayX,e.displayY,this.dotRadius,0,2*Math.PI),t.closePath(),t.fill()}drawAxes(){const{ctx:e,left:t,right:a,top:n,bottom:s}=this;e.beginPath(),e.moveTo(t,n),e.lineTo(t,s),e.moveTo(t,s),e.lineTo(a,s),e.strokeStyle="gray",e.stroke()}drawDashedLine(e,t,a,n){const{ctx:s}=this;s.beginPath(),s.setLineDash([8,4]),s.moveTo(e,a),s.lineTo(t,n),s.stroke()}drawLine(e,t,a,n){const{ctx:s}=this;s.beginPath(),s.setLineDash([]),s.moveTo(e,a),s.lineTo(t,n),s.stroke()}drawScaleGrid(e,t,a){const{ctx:n,left:s,right:i}=this;for(let l=e;l>t;l-=a){let e=this.roundToMultiple(l,1e3),t=this.getDisplayXY(s-10,e).displayY;n.fillText(new Intl.NumberFormat("ru-RU").format(e),s-10,t),0===l?this.drawLine(s,i,t,t):this.drawDashedLine(s,i,t,t)}}drawYScale(){const{ctx:e,left:t,right:a}=this,n=this.roundToMultiple(this.rangeY.max,10)/5,s=this.roundToMultiple(Math.abs(this.rangeY.min),10)/5;e.textAlign="right",e.textBaseline="middle";const i=this.getDisplayXY(t-10,0).displayY;this.drawScaleGrid(this.rangeY.max,0,n),this.rangeY.min<0&&this.drawScaleGrid(0,this.rangeY.min,s),e.fillText(new Intl.NumberFormat("ru-RU").format(this.rangeY.min),t-10,this.bottom),e.setLineDash([]),this.drawLine(t,a,i,i)}drawXScale(){const{cnv:e,ctx:t,bottom:a,top:n}=this;let s;if(t.textAlign="center",e===$id("osCnv"))for(let e=this.rangeX.min;e<=this.rangeX.max;e++)e/5%1==0&&(s=this.getDisplayXY(e,a+10).displayX,t.fillText(e/5,s,a+10)),0!==e&&this.drawDashedLine(s,s,a,n);else for(let e=this.rangeX.min;e<=this.rangeX.max;e++)s=this.getDisplayXY(e,a+10).displayX,t.fillText(e,s,a+10),0!==e&&this.drawDashedLine(s,s,a,n);t.setLineDash([])}drawContent(e,t,a=1){const{ctx:n}=this;let s=this.getDisplayXY(e.values[0].X,e.values[0].Y*a);n.setLineDash([]),this.dotsCheck.checked&&this.dot(s);for(let i=1;i<=e.values.length-1;i++){const l=this.getDisplayXY(e.values[i].X,e.values[i].Y*a);this.dotsValCheck.checked&&n.fillText(e.values[i-1].Y,s.displayX,s.displayY-5),this.connector(s,l,t),this.dotsCheck.checked&&this.dot(l),s=l}this.dotsValCheck.checked&&n.fillText(e.values[e.values.length-1].Y,s.displayX-5,s.displayY-5)}clearCanvas(){const{ctx:e}=this;e.clearRect(0,0,this.width,this.height)}drawCanvas(){const{ctx:e}=this;this.clearCanvas(),e.lineWidth=1,this.drawAxes(),this.drawXScale(),this.drawYScale()}oscilloInitrender(e){this.rangeY=this.calcSourceMinMax("Y",e.a.values,e.b.values,e.c.values),this.rangeX=this.calcSourceMinMax("X",e.a.values,e.b.values,e.c.values),this.drawCanvas(),this.drawContent(e.a,"red"),this.drawContent(e.b,"blue"),this.drawContent(e.c,"green"),this.drawContent(e.bk,"purple",this.rangeY.max/2)}choosePhRegim(e,t,a){this.rangeY=this.calcSourceMinMax("Y",t[e].values),this.rangeX=this.calcSourceMinMax("X",t[e].values),this.drawCanvas(),this.drawContent(t[e],a)}}const osData={info:[{f:1},{1:666},{2:2022},{3:11},{4:2},{5:16},{6:20},{7:1},{8:999},{9:0}],a:{values:[{X:0,Y:14e4},{X:1,Y:0},{X:2,Y:-2e4},{X:3,Y:28e3},{X:4,Y:10034},{X:5,Y:14e3},{X:6,Y:-2e4},{X:7,Y:28e3},{X:8,Y:10034},{X:9,Y:14e3},{X:11,Y:14e3},{X:12,Y:-2e4},{X:17,Y:28e3},{X:18,Y:10034},{X:19,Y:14e3}]},b:{values:[{X:0,Y:-3e4},{X:1,Y:-110500},{X:2,Y:27e3},{X:3,Y:1034},{X:4,Y:14e3},{X:5,Y:2e3}]},c:{values:[{X:0,Y:-3e4},{X:1,Y:-11e4},{X:2,Y:22e3},{X:3,Y:1034},{X:4,Y:14e3},{X:5,Y:151320}]},bk:{values:[{X:0,Y:1},{X:1,Y:1},{X:2,Y:0},{X:3,Y:1},{X:4,Y:1},{X:5,Y:1}]}},osChrt=new Chart({canvasId:"osCnv",dotsCheck:"osCnvDots",dotsValCheck:"osCnvDotsVal"},osData);addOptToOscilloSelect(osData);const oscilorgamsTableBody=$id("oscilorgamsTableBody"),addRowsToOscilorgamsTableBody=()=>{for(let e=osData.a.values[0].X;e<osData.a.values.length;e++)oscilorgamsTableBody.insertAdjacentHTML("beforeend",`\n    <tr>\n      <td>${e}</td>     \n      <td>${osData.bk.values[e]?osData.bk.values[e].Y:"-"}</td>\n      <td>${osData.a.values[e].Y}</td>\n      <td>${osData.b.values[e]?osData.b.values[e].Y:"-"}</td>\n      <td>${osData.c.values[e]?osData.c.values[e].Y:"-"}</td>\n    </tr>\n    `)};addRowsToOscilorgamsTableBody(),$id("oscillograms-tab").addEventListener("click",()=>{osChrt.oscilloInitrender(osData)}),oscilloViewbtn.addEventListener("click",()=>{osChrt.oscilloInitrender(osData)});const chooseOsciloCanvasRegim=e=>{switch(e){case"a":osChrt.choosePhRegim("a",osData,"red"),osChrt.drawContent(osData.bk,"purple",osChrt.rangeY.max/2);break;case"b":osChrt.choosePhRegim("b",osData,"blue"),osChrt.drawContent(osData.bk,"purple",osChrt.rangeY.max/2);break;case"c":osChrt.choosePhRegim("c",osData,"green"),osChrt.drawContent(osData.bk,"purple",osChrt.rangeY.max/2);break;default:osChrt.oscilloInitrender(osData)}};$id("osciloCanvasRegim").addEventListener("change",e=>{osChrt.drawCanvas(),chooseOsciloCanvasRegim(e.target.value)}),$id("osCnvDots").addEventListener("change",()=>{osChrt.drawCanvas(),chooseOsciloCanvasRegim($id("osciloCanvasRegim").value)}),$id("osCnvDotsVal").addEventListener("change",()=>{osChrt.drawCanvas(),chooseOsciloCanvasRegim($id("osciloCanvasRegim").value)});const measurmentsDBTabs=document.querySelector(".measurmentsDB-tabs"),measurmentDBTab=document.querySelectorAll(".measurmentDB-tab"),measurmentsDBContent=document.querySelectorAll(".measurmentsDB-content");measurmentsDBTabs.addEventListener("click",e=>tabsSwitcher(e,measurmentDBTab,measurmentsDBContent));let trData={a:{values:[{X:0,Y:14e4},{X:1,Y:0},{X:3,Y:28e3}],dates:["11.11.1111 01:01:01.1111","22.22.2222 02:02:02.2222","33.33.3333 03:03:03.3333","44.44.4444 44:44:44.4444"]},b:{values:[{X:0,Y:12e4},{X:1,Y:0},{X:2,Y:-2e4},{X:3,Y:28e3}]},c:{values:[{X:0,Y:1e4},{X:1,Y:0},{X:2,Y:-2e4},{X:3,Y:28e3}]}};const trChrt=new Chart({canvasId:"trndsCnv",dotsCheck:"trCnvDts",dotsValCheck:"trCnvDtsVal"},trData),trndsInitRndr=()=>{trChrt.drawCanvas(),trChrt.drawContent(trData.a,"red"),trChrt.drawContent(trData.b,"blue"),trChrt.drawContent(trData.c,"green")};trndsInitRndr();const colors={a:"red",b:"blue",c:"green"},chooseTrPh=e=>{switch(e){case"all":trndsInitRndr();break;default:trChrt.choosePhRegim(e,trData,colors[e])}};$id("trCnvRegim").addEventListener("change",()=>{chooseTrPh($id("trPhses").value)}),$id("trPhses").addEventListener("change",e=>{chooseTrPh(e.target.value)}),$id("trCnvDates").addEventListener("change",()=>{trChrt.drawCanvas(),chooseTrPh($id("trPhses").value)}),$id("trCnvDtsVal").addEventListener("change",()=>{trChrt.drawCanvas(),chooseTrPh($id("trPhses").value)}),$id("trCnvDts").addEventListener("change",()=>{trChrt.drawCanvas(),chooseTrPh($id("trPhses").value)});const configurationTabs=document.querySelector(".configuration-tabs"),configurationTab=document.querySelectorAll(".configuration-tab"),configurationContent=document.querySelectorAll(".configuration-content");function addZero(e){return e<10&&(e="0"+e),e}function pcTime(){const e=new Date;return{day:addZero(e.getDate()),month:addZero(e.getMonth()+1),year:e.getFullYear(),hours:addZero(e.getHours()),minutes:addZero(e.getMinutes()),seconds:addZero(e.getSeconds())}}configurationTabs.addEventListener("click",e=>tabsSwitcher(e,configurationTab,configurationContent)),setInterval(()=>{$id("current_date_time_block").innerHTML=`\n  ${pcTime().day}.${pcTime().month}.${pcTime().year}\n  ${pcTime().hours}:${pcTime().minutes}:${pcTime().seconds}`},1e3);const setHadleTimeInput=()=>{$id("handleDay").value=pcTime().day,$id("handleMounth").value=pcTime().month,$id("handleYear").value=pcTime().year,$id("handleHour").value=pcTime().hours,$id("handleMin").value=pcTime().minutes};setHadleTimeInput(),setInterval(()=>setHadleTimeInput(),3e4);const modal=$id("myModal"),modalBtn=$id("modalBtn"),closeModal=document.getElementsByClassName("close")[0];closeModal.onclick=(()=>{modal.style.display="none"});const setModalContent=e=>{const t=document.querySelector(".modal-content");t.removeChild(t.children[1]),t.insertAdjacentHTML("beforeend",e),modal.style.display="block"},statusAlarm=document.querySelector(".status-alarm"),statusAlarmSignal=e=>{statusAlarm.classList.remove("d-none"),"warning"===e?(statusAlarm.textContent="Внимание",statusAlarm.classList.remove("accident-signal"),statusAlarm.classList.add("warning-signal","blink"),document.querySelector(".warning-signal").classList.add("blink")):(statusAlarm.textContent="Авария",statusAlarm.classList.remove("warning-signal"),statusAlarm.classList.add("accident-signal","blink"),document.querySelector(".accident-signal").classList.add("blink"))},accidentModal=()=>{setModalContent('<p class="tac my-5">Произошло срабатывание сигнализации. <br/> Для просмотра более подробной информации нажмите на индикатор "Авария" в Главном окне</p>'),statusAlarmSignal("warning")},generalAlarm=()=>{setModalContent(' <div class="mt-4">\n  <h3 class="tac my-3">Общая сигнализация</h3>\n    <div class="row card">\n      <h4 class="mb-3 tac">События</h4>\n      <div class="row card flex-row">\n        <div class="col-4 mt-2 me-4">\n          <div > <input type="checkbox" name="" id="">  Собственное время отключения </div>\n          <div class="mt-1"> <input type="checkbox" name="" id="">  Полное время отключения</div>\n          <div class="mt-1"> <input type="checkbox" name="" id="">  Собственное время включения</div>\n          <div class="mt-1"> <input type="checkbox" name="" id="">  Время включения </div>\n        </div>\n        <div class="col mt-2 ms-2">\n          <div > <input type="checkbox" name="" id=""> Невыполненная команда на соленоид отключения 1</div>\n          <div class="mt-1"> <input type="checkbox" name="" id=""> Невыполненная команда на соленоид отключения 2</div>\n          <div class="mt-1"> <input type="checkbox" name="" id=""> Невыполненная команда на соленоид включения</div>\n        </div>\n      </div>\n      <div class="row mt-2">\n        <div class="col card">\n          <h4 class="mb-2">Колличество операций</h4>\n          <div> <input type="checkbox" name="" id="">  Внимание </div>\n          <div class="mt-1"> <input type="checkbox" name="" id="">  Авария</div>\n        </div>\n        <div class="col-4 card ms-2">\n          <h4 class="mb-2">Неполнофазный режим работы</h4>\n          <div> <input type="checkbox" name="" id="">  Авария</div>\n        </div>\n        <div class="col ">\n          <div class="tac"> <button class="mt-4 ">  Сброс сигналов событий</button></div>\n        </div>\n      </div>\n    </div>\n      <h3 class="tac my-3">Cигнализация измерений</h3>\n      <div class="row card flex-row mt-2 justify-content-evenly">\n        <div class="col card">\n          <h3 class="mb-2 tac">Фаза А</h3>\n          <div class="row">\n            <h4 class="my-3">Износ контактов </h4>\n          </div>\n          <div class="row">\n            <div class="col"> <input type="checkbox" name="" id="">Внимание </div>\n            <div class="col"> <input type="checkbox" name="" id="">Авария</div>\n          </div>\n          <hr class="mt-3">\n          <h4 class="my-3">События </h4>\n          <div > <input type="checkbox" name="" id="">Время горения дуги</div>\n          <div class="mt-1"> <input type="checkbox" name="" id="">Повторное зажигание дуги</div>\n        </div>\n      <div class="col card mx-2">\n        <h3 class="mb-2 tac">Фаза B</h3>\n        <div class="row">\n          <h4 class="my-3">Износ контактов </h4>\n        </div>\n        <div class="row">\n          <div class="col"> <input type="checkbox" name="" id="">Внимание </div>\n          <div class="col"> <input type="checkbox" name="" id="">Авария</div>\n        </div>\n        <hr class="mt-3">\n        <h4 class="my-3">События </h4>\n        <div > <input type="checkbox" name="" id="">Время горения дуги</div>\n        <div class="mt-1"> <input type="checkbox" name="" id="">Повторное зажигание дуги</div>\n      </div>\n      <div class="col card">\n        <h3 class="mb-2 tac">Фаза C</h3>\n        <div class="row">\n          <h4 class="my-3">Износ контактов </h4>\n        </div>\n        <div class="row">\n          <div class="col"> <input type="checkbox" name="" id="">Внимание </div>\n          <div class="col"> <input type="checkbox" name="" id="">Авария</div>\n        </div>\n        <hr class="mt-3">\n        <h4 class="my-3">События </h4>\n        <div > <input type="checkbox" name="" id="">Время горения дуги</div>\n        <div class="mt-1"> <input type="checkbox" name="" id="">Повторное зажигание дуги</div>\n      </div>\n    </div>\n  </div>\n  '),statusAlarmSignal("accident")},selfDiagnosisAlarm=()=>{setModalContent('<div class="mt-4">\n    <div class="row justify-content-center card">\n      <div class="col ms-5">\n        <div><input type="checkbox" name="" id="">Неисправность внутренней FLASH-памяти</div>\n        <div class="mt-2 "><input type="checkbox" name="" id="">Неисправность внутренней SRAM-памяти</div>\n        <div class="mt-2"><input type="checkbox" name="" id="">Неисправность АЦП</div>\n        <div class="mt-2"><input type="checkbox" name="" id="">Ошибка считывания FRAM (энергозависимых данных). Приняты данные по умолчанию</div>\n        </div>\n      </div>\n    </div>\n    </div>'),document.querySelector(".self-diagnosis-signal").classList.add("blink")};$id("statusAlarm").addEventListener("click",()=>statusAlarmSignal()),$id("accidentAlarm").addEventListener("click",()=>(setModalContent('<p class="tac my-5">Произошло срабатывание сигнализации. <br/> Для просмотра более подробной информации нажмите на индикатор "Авария" в Главном окне</p>'),void statusAlarmSignal("warning"))),$id("generalAlarm").addEventListener("click",()=>(setModalContent(' <div class="mt-4">\n  <h3 class="tac my-3">Общая сигнализация</h3>\n    <div class="row card">\n      <h4 class="mb-3 tac">События</h4>\n      <div class="row card flex-row">\n        <div class="col-4 mt-2 me-4">\n          <div > <input type="checkbox" name="" id="">  Собственное время отключения </div>\n          <div class="mt-1"> <input type="checkbox" name="" id="">  Полное время отключения</div>\n          <div class="mt-1"> <input type="checkbox" name="" id="">  Собственное время включения</div>\n          <div class="mt-1"> <input type="checkbox" name="" id="">  Время включения </div>\n        </div>\n        <div class="col mt-2 ms-2">\n          <div > <input type="checkbox" name="" id=""> Невыполненная команда на соленоид отключения 1</div>\n          <div class="mt-1"> <input type="checkbox" name="" id=""> Невыполненная команда на соленоид отключения 2</div>\n          <div class="mt-1"> <input type="checkbox" name="" id=""> Невыполненная команда на соленоид включения</div>\n        </div>\n      </div>\n      <div class="row mt-2">\n        <div class="col card">\n          <h4 class="mb-2">Колличество операций</h4>\n          <div> <input type="checkbox" name="" id="">  Внимание </div>\n          <div class="mt-1"> <input type="checkbox" name="" id="">  Авария</div>\n        </div>\n        <div class="col-4 card ms-2">\n          <h4 class="mb-2">Неполнофазный режим работы</h4>\n          <div> <input type="checkbox" name="" id="">  Авария</div>\n        </div>\n        <div class="col ">\n          <div class="tac"> <button class="mt-4 ">  Сброс сигналов событий</button></div>\n        </div>\n      </div>\n    </div>\n      <h3 class="tac my-3">Cигнализация измерений</h3>\n      <div class="row card flex-row mt-2 justify-content-evenly">\n        <div class="col card">\n          <h3 class="mb-2 tac">Фаза А</h3>\n          <div class="row">\n            <h4 class="my-3">Износ контактов </h4>\n          </div>\n          <div class="row">\n            <div class="col"> <input type="checkbox" name="" id="">Внимание </div>\n            <div class="col"> <input type="checkbox" name="" id="">Авария</div>\n          </div>\n          <hr class="mt-3">\n          <h4 class="my-3">События </h4>\n          <div > <input type="checkbox" name="" id="">Время горения дуги</div>\n          <div class="mt-1"> <input type="checkbox" name="" id="">Повторное зажигание дуги</div>\n        </div>\n      <div class="col card mx-2">\n        <h3 class="mb-2 tac">Фаза B</h3>\n        <div class="row">\n          <h4 class="my-3">Износ контактов </h4>\n        </div>\n        <div class="row">\n          <div class="col"> <input type="checkbox" name="" id="">Внимание </div>\n          <div class="col"> <input type="checkbox" name="" id="">Авария</div>\n        </div>\n        <hr class="mt-3">\n        <h4 class="my-3">События </h4>\n        <div > <input type="checkbox" name="" id="">Время горения дуги</div>\n        <div class="mt-1"> <input type="checkbox" name="" id="">Повторное зажигание дуги</div>\n      </div>\n      <div class="col card">\n        <h3 class="mb-2 tac">Фаза C</h3>\n        <div class="row">\n          <h4 class="my-3">Износ контактов </h4>\n        </div>\n        <div class="row">\n          <div class="col"> <input type="checkbox" name="" id="">Внимание </div>\n          <div class="col"> <input type="checkbox" name="" id="">Авария</div>\n        </div>\n        <hr class="mt-3">\n        <h4 class="my-3">События </h4>\n        <div > <input type="checkbox" name="" id="">Время горения дуги</div>\n        <div class="mt-1"> <input type="checkbox" name="" id="">Повторное зажигание дуги</div>\n      </div>\n    </div>\n  </div>\n  '),void statusAlarmSignal("accident"))),$id("selfDiagnosislAlarm").addEventListener("click",()=>(setModalContent('<div class="mt-4">\n    <div class="row justify-content-center card">\n      <div class="col ms-5">\n        <div><input type="checkbox" name="" id="">Неисправность внутренней FLASH-памяти</div>\n        <div class="mt-2 "><input type="checkbox" name="" id="">Неисправность внутренней SRAM-памяти</div>\n        <div class="mt-2"><input type="checkbox" name="" id="">Неисправность АЦП</div>\n        <div class="mt-2"><input type="checkbox" name="" id="">Ошибка считывания FRAM (энергозависимых данных). Приняты данные по умолчанию</div>\n        </div>\n      </div>\n    </div>\n    </div>'),void document.querySelector(".self-diagnosis-signal").classList.add("blink")));const serviceModal=()=>{const e=$id("serviceModalContent");e.style.display="block",$id("serviceClose").addEventListener("click",()=>{e.style.display="none"})};$id("serviceModal").addEventListener("click",()=>serviceModal());const resetEventsJournal=$id("0x100"),resetMeassurmentsJournal=$id("0x101"),resetOscillogramms=$id("0x102"),resetAccumulatedMeasurements=$id("0x103"),setDefaultConfiguration=$id("0x104"),calibrationFor1000=$id("0x10A"),calibrationFor10000=$id("0x10B"),setAlarm=$id("0x10C"),resetAlarm=$id("0x10D"),setPhaseAWear=$id("0x105"),setPhaseBWear=$id("0x106"),setPhaseCWear=$id("0x107"),setNumberOfTurns=$id("0x108"),setNumberOfShutdowns=$id("0x109"),comandBtns=[resetEventsJournal,resetMeassurmentsJournal,resetOscillogramms,setDefaultConfiguration,resetAccumulatedMeasurements,calibrationFor1000,calibrationFor10000,setAlarm,resetAlarm],comandBtnsWithArg=[setPhaseAWear,setPhaseBWear,setPhaseCWear,setNumberOfTurns,setNumberOfShutdowns],findReg=e=>$id(`${e}`),findRegDataId=e=>document.querySelectorAll(`[data-id='${e}']`),isEmpty=e=>!Object.values(e).some(e=>null!==e&&""!==e);let view474475=new DataView(new ArrayBuffer(4)),view477478=new DataView(new ArrayBuffer(4)),firmwareStr="",oscilloNumSum=0;function dbg_out(e){console.log(e)}const socket=new WebSocket("ws://127.0.0.1:8080",76);function send(e,t,a){let n=new Uint16Array(64);n[0]=e,n[1]=t,n[2]=a,socket&&1===socket.readyState&&socket.send(n)}const sendCommand=e=>{const t=e.target.id;console.log("code ",t),send(1,551,t),send(1,550,t)},sendCommandWithArg=e=>{const t=e.target.id,a=document.querySelector(`[data-id='${t}']`).value;console.log("code arg",t),console.log("val arg",a),send(1,551,t),send(1,550,a)};comandBtns.forEach(e=>e.addEventListener("click",e=>sendCommand(e))),comandBtnsWithArg.forEach(e=>e.addEventListener("click",e=>sendCommandWithArg(e)));let upload_pointer=0,firmware_array=0;const regArrayToSetValuesInSpan=["10","11","12","0000","0001","0002","0003","0010","0011","0012","0013","0014","0015","0109","0110","0012","0014","0016","0251","0252","0253","0254","0255","0256","0257","0258","0260","0261","0262","0263","0264","0265","0266","0267","414","415"],regArrayToSetValuesInSpanDataId=["0200","0300","600-601"],regArrayToSetValuesInInput=[410,411,413,432,433,434,435,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,467,468,471,473,476],regArrayToSetValuesTo32=[474,475],regToFirmwareArray=[484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,517,518,519],regArrayToSetValuesIfElse=["0111","0259"],phasesCoefficent=["0113","0115","0117"],measurementsJournal=["0201","0204","0206","0207","0208","0209","0210","0211","0212","0213","0214","0215","0216","0217","0218","0219","0220","0221","0222","0223","0224","0225","0226","0227","0228"],eventsJournal=["0301","0303","0304","0305","0306","0307","0308","0309","0310","0311"],oscilloPhaseASign=[1,5,9,13,17,21,25,29,33,37,41,45,49,53,57,61,65,69,73,77,81,85,89,93,97],oscilloPhaseCSign=[3,7,11,15,19,23,27,31,35,39,43,47,51,55,59,63,67,71,75,79,83,87,91,95,99],oscillosJournal=["0600","0601"],osciloCurrentInfo=["0602","0603","0605","0606","0607","0608","0609","0610","0611","0612"];function recv(e){const t=new FileReader;t.onload=(()=>{let e=new Uint16Array(t.result),a=e[1],n=e[2];console.log(a),regArrayToSetValuesInSpan.includes(`${a}`)&&(findReg(`${a}`).textContent=.01*n,findReg(`${a}`).textContent=n),regArrayToSetValuesInSpanDataId.includes(`${a}`)&&[...findRegDataId(`${a}`)].forEach(e=>{e.textContent=n}),"0111"===a&&1===n&&(findReg(`${a}`).textContent="Включено"),"0111"===a&&2===n&&(findReg(`${a}`).textContent="Отключено"),findReg(`${a}`).textContent=(.01*n).toFixed(2),"0113"===a&&markElemInDiagramm("#phaseDiagrammA",.01*n),"0115"===a&&markElemInDiagramm("#phaseDiagrammB",.01*n),"0117"===a&&markElemInDiagramm("#phaseDiagrammC",.01*n),"0259"===a&&1===n&&(findReg(`${a}`).textContent="ВКЛ."),"0259"===a&&2===n&&(findReg(`${a}`).textContent="ОТКЛ."),eventsJournal.includes(a)&&(eventsTableCurrentObj[`${a}`]=n,isEmpty(eventsTableCurrentObj)||addCurrentEntryToEventsTable()),measurementsJournal.includes(a)&&(measurmentsTableCurrentObj[`${a}`]=n,isEmpty(measurmentsTableCurrentObj)||addCurrentEntryToEventsTable()),regArrayToSetValuesTo32.includes(a)&&(474===a&&view474475.setInt16(0,n,!1),475===a&&(view474475.setInt16(2,n,!1),findReg("474-475").value=view474475.getFloat32(0,!1)),477===a&&view477478.setInt16(0,n,!1),478===a&&(view477478.setInt16(2,n,!1),findReg("477-478").value=view477478.getFloat32(0,!1))),regToFirmwareArray.includes(a)&&(firmwareStr+=n,$id("484-519").textContent=firmwareStr),"0600"!==a&&"0601"!==a||(oscilloNumSum+=n,findReg("600-601").textContent=oscilloNumSum),osciloCurrentInfo.includes(a)&&osData.info.push({register:n}),a>=613&&a<=4616&&(oscilloPhaseASign.includes(Number(n.toString().slice(-2)))&&osData.a.values.push({x:osData.a.values.length,y:n}),a%2==0&&a%4!=0&&osData.b.values.push({x:osData.b.values.length,y:n}),oscilloPhaseCSign.includes(Number(n.toString().slice(-2)))&&osData.c.values.push({x:osData.c.values.length,y:n}),a%4==0&&osData.bk.values.push({x:osData.bk.values.length,y:n})),398===e[1]&&((upload_pointer=e[2]+(e[3]<<16))<65536?socket&&1===socket.readyState&&socket.send(firmware_array.subarray(upload_pointer,upload_pointer+512)):upload_pointer=0)}),t.readAsArrayBuffer(e)}function setDate(){send(0,10,0),send(0,11,0),send(0,12,0)}function read_file(e){const t=e.files[0],a=new FileReader;a.onload=(()=>{let e=new Uint8Array(a.result);new Uint8Array(65536).fill(255,0,65536).set(e);let n=new Uint8Array(512).fill(0,0,512);for(let e=0;e<t.name.length;e++)n[e]=t.name.charCodeAt(e);socket&&1===socket.readyState&&socket.send(n)}),a.readAsArrayBuffer(t)}socket.onopen=(e=>{regArrayToSetValuesInSpan.forEach(e=>send(0,e,0)),phasesCoefficent.forEach(e=>send(0,e,0))}),socket.onmessage=(e=>{recv(e.data)}),socket.onclose=(e=>{e.wasClean?dbg_out("Соединение закрыто нормально"):dbg_out("Соединение закрыто экстренно")}),socket.onerror=(e=>{dbg_out("Ошибка соединения: "+e.message)}),$id("setDate").addEventListener("click",setDate),$id("file").addEventListener("change",()=>{read_file(this)});